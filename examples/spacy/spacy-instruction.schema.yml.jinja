schema:
  $schema: https://json-schema.org/draft/2020-12/schema
  $id: https://github.com/instructions-d-installation/installation-instruction/examples/spacy/schema_spacy.yml
  title: Spacy Install Schema
  description: This is a schema which is used for constructing interactive installation instructions.
  type: object
  $comment: by Kanushka Gupta
  properties: 
    os:
      title: Operating System
      description: Specify your Operating System
      enum:
        - mac
        - windows
        - linux
      default: windows

    platform:
      title: Platform
      description: platform
      enum:
        - x86
        - arm 
      default: x86

    package:
      title: Package Manager
      description: The package manager you use.
      enum:
        - pip
        - conda
        - source
      default: pip

    hardware:
      title: Hardware
      description: Hardware you want to use- CPU or GPU?
      enum:
        - cpu
        - gpu
      type: string
      default: cpu

    configuration:
      title: Configuration
      description: the configuration you have
      enum:
        - virtual env
        - train_models
      default: virtual env
    
  trained_pipelines: 
    title: Trained Pipelines
    description: the language package you want to include
    type: array
    items: 
      type: string
      enum: 
        - Catalan
        - Chinese
        - Croatian 
        - Danish
        - Dutch
        - English
        - Finnish
        - French
        - German 
        - Greek
        - Italian 
        - Japanese
        - Korean 
        - Lithuanian
        - Macedonian
        - Multi-language
        - Norwegian Bokmål
        - Polish
        - Portuguese
        - Romanian
        - Russian
        - Slovenian
        - Spanish 
        - Swedish
        - Ukrainian
  allOf:      
    - if:
        properties:
          trained_pipelines:
            minLength: 1
      then: 
        properties:   
          pipeline: 
            title: Select pipeline for
            description: Select pipeline for -
            enum: 
              - efficiency
              - accuracy
            type: string
            default: efficiency

    - if:
        properties:
          hardware:
            const: gpu
      then:
        properties:
          cuda_runtime:
            enum:
              - CUDA 8.0
              - CUDA 9.0
              - CUDA 9.1
              - CUDA 9.2
              - CUDA 10.0
              - CUDA 10.1
              - CUDA 10.2
              - CUDA 11.0
              - CUDA 11.1
              - CUDA 11.2 - 11.x
              - CUDA 12.x
            
  required: [
    "os",
    "platform",
    "package",
    "hardware",
    "configuration"
  ]

pretty:
  mac: macOs/OSX
  windows: Windows
  linux: Linux
  x86: x86
  arm: ARM/M1
  pip: Pip
  conda: Conda
  cpu: CPU
  gpu: GPU
  virtual env: virtual env
  train_models: train models
  efficiency: efficiency
  accuracy: accuracy

------
{# {% macro raise %}
  {% if pipeline == "effiency" %}
    {% if trained_pipelines == "Catalan"%}
      python -m spacy download ca_core_news_sm
    {% if trained_pipelines == "Chinese"%}
      python -m spacy download zh_core_web_sm
    {% if trained_pipelines == "Croatian"%}
      python -m spacy download hr_core_news_sm
    {% if trained_pipelines == "Danish"%}
      python -m spacy download da_core_news_sm
    {% if trained_pipelines == "Dutch"%}
      python -m spacy download nl_core_news_sm
    {% if trained_pipelines == "English"%}
      python -m spacy download en_core_web_sm
    {% if trained_pipelines == "Finnish"%}
      python -m spacy download fi_core_news_sm
    {% if trained_pipelines == "French"%}
      python -m spacy download fr_core_news_sm
    {% if trained_pipelines == "German"%}
      python -m spacy download de_core_news_sm
    {% if trained_pipelines == "Greek"%}
      python -m spacy download el_core_news_sm
    {% if trained_pipelines == "Italian"%}
      python -m spacy download it_core_news_sm
    {% if trained_pipelines == "Japanese"%}
      python -m spacy download ja_core_news_sm
    {% if trained_pipelines == "Korean"%}
      python -m spacy download ko_core_news_sm
    {% if trained_pipelines == "Lithuanian"%}
      python -m spacy download lt_core_news_sm
    {% if trained_pipelines == "Macedonian"%}
      python -m spacy download mk_core_news_sm
    {% if trained_pipelines == "Multi-language"%}
      python -m spacy download xx_ent_wiki_sm
    {% if trained_pipelines == "Norwegian Bokmål"%}
      python -m spacy download nb_core_news_sm
    {% if trained_pipelines == "Polish"%}
      python -m spacy download pl_core_news_sm
    {% if trained_pipelines == "Portuguese"%}
      python -m spacy download pt_core_news_sm
    {% if trained_pipelines == "Romanian"%}
      python -m spacy download ro_core_news_sm
    {% if trained_pipelines == "Russian"%}
      python -m spacy download ru_core_news_sm
    {% if trained_pipelines == "Slovenian"%}
      python -m spacy download sl_core_news_sm
    {% if trained_pipelines == "Spanish"%}
      python -m spacy download es_core_news_sm
    {% if trained_pipelines == "Swedish"%}
      python -m spacy download sv_core_news_sm
    {% if trained_pipelines == "Ukrainian"%}
      python -m spacy download uk_core_news_sm     

  {% if pipeline == "accuracy" %}
    {% if trained_pipelines == "Catalan"%}
      python -m spacy download ca_core_news_trf
    {% if trained_pipelines == "Chinese"%}
      python -m spacy download zh_core_web_trf
    {% if trained_pipelines == "Croatian"%}
      python -m spacy download hr_core_news_lg
    {% if trained_pipelines == "Danish"%}
      python -m spacy download da_core_news_trf
    {% if trained_pipelines == "Dutch"%}
      python -m spacy download nl_core_news_lg
    {% if trained_pipelines == "English"%}
      python -m spacy download en_core_web_trf
    {% if trained_pipelines == "Finnish"%}
      python -m spacy download fi_core_news_lg
    {% if trained_pipelines == "French"%}
      python -m spacy download fr_core_news_trf
    {% if trained_pipelines == "German"%}
      python -m spacy download de_core_news_trf
    {% if trained_pipelines == "Greek"%}
      python -m spacy download el_core_news_lg
    {% if trained_pipelines == "Italian"%}
      python -m spacy download it_core_news_lg
    {% if trained_pipelines == "Japanese"%}
      python -m spacy download ja_core_news_trf
    {% if trained_pipelines == "Korean"%}
      python -m spacy download ko_core_news_lg
    {% if trained_pipelines == "Lithuanian"%}
      python -m spacy download lt_core_news_lg
    {% if trained_pipelines == "Macedonian"%}
      python -m spacy download mk_core_news_lg
    {% if trained_pipelines == "Multi-language"%}
      python -m spacy download xx_ent_wiki_sm
    {% if trained_pipelines == "Norwegian Bokmål"%}
      python -m spacy download nb_core_news_lg
    {% if trained_pipelines == "Polish"%}
      python -m spacy download pl_core_news_lg
    {% if trained_pipelines == "Portuguese"%}
      python -m spacy download pt_core_news_lg
    {% if trained_pipelines == "Romanian"%}
      python -m spacy download ro_core_news_lg
    {% if trained_pipelines == "Russian"%}
      python -m spacy download ru_core_news_lg
    {% if trained_pipelines == "Slovenian"%}
      python -m spacy download sl_core_news_trf
    {% if trained_pipelines == "Spanish"%}
      python -m spacy download es_core_news_trf
    {% if trained_pipelines == "Swedish"%}
      python -m spacy download sv_core_news_lg
    {% if trained_pipelines == "Ukrainian"%}
      python -m spacy download uk_core_news_trf  
{%endmacro%}

{% if package == "pip" %}
  pip install -U pip setuptools wheel &&
  pip install -U spacy

    {% if hardware == "cpu"  %}
      {% if os == "mac"%}
        {% if platform == "arm"%}
          -'[apple]'
        {% endif %}
      {% endif %}
    {% endif %}

    {%if hardware == "gpu" %}
      {% if os == "linux"%}
        [cuda111]
      {% endif %}
      {%if os == "mac"%}
        [apple]
      {%endif%}
    {%endif%}
{%endif%}    

{% if package == "conda" %}     
  conda install -c conda-forge spacy
  {%if hardware == "gpu"%}
    conda install -c conda-forge cupy
  {%endif%}
{%endif%}

{%if package == "source"%}
  pip install -U pip setuptools wheel &&
  git clone https://github.com/explosion/spaCy &&
  cd spaCy &&
  pip install -r requirements.txt &&
  pip install --no-build-isolation --editable .

  {% if hardware == "gpu"%}
    {% if platform == "x86"%}
      '[cuda111]'
    {%endif%}
    {% if platform == "arm"%}
      {%if os == "windows"%}
        '[]'
      {%endif%}
      {% if os == "linux"%} 
        '[cuda111]'
      {%endif%}
      {% if os == "mac"%} 
        '[apple]'
      {%endif%}
    {%endif%}
  {%endif%}
{%endif%}

 #}


{% macro generate_installation_command(os, platform, package, hardware, configuration, trained_pipelines, pipeline, cuda_runtime) %}
pip install -U pip setuptools wheel
pip install -U spacy
{% if package == "pip" %}
pip install -U spacy
{% if configuration == 'train_models' %}
pip install -U 'spacy[transformers,lookups]'
{% endif %}
{% if trained_pipelines %}
{% for pipeline in trained_pipelines %}
python -m spacy download {{ pipeline.lower().replace(" ", "_") }}
{% endfor %}
{% endif %}
{% if hardware == 'gpu' %}
# Install CUDA runtime
{% if cuda_runtime %}
pip install cupy-cuda{{ cuda_runtime.split(' ')[1].replace('.', '') }}
{% endif %}
{% endif %}
{% elif package == "conda" %}
conda install -c conda-forge spacy
{% if trained_pipelines %}
{% for pipeline in trained_pipelines %}
python -m spacy download {{ pipeline.lower().replace(" ", "_") }}
{% endfor %}
{% endif %}
{% if hardware == 'gpu' %}
# Install CUDA runtime
{% if cuda_runtime %}
conda install -c conda-forge cupy-cuda{{ cuda_runtime.split(' ')[1].replace('.', '') }}
{% endif %}
{% endif %}
{% else %}
{{ raise("Unsupported package manager!") }}
{% endif %}
{% endmacro %}

{{ generate_installation_command(os, platform, package, hardware, configuration, trained_pipelines, pipeline, cuda_runtime) }} #}


{# 
{% macro raise(error) %}
  "{% if package == "effiency" %}
    {% if trained_pipelines == "Catalan"%}
      python -m spacy download ca_core_news_sm
    {% if trained_pipelines == "Chinese"%}
      python -m spacy download zh_core_web_sm
    {% if trained_pipelines == "Croatian"%}
      python -m spacy download hr_core_news_sm
    {% if trained_pipelines == "Danish"%}
      python -m spacy download da_core_news_sm
    {% if trained_pipelines == "Dutch"%}
      python -m spacy download nl_core_news_sm
    {% if trained_pipelines == "English"%}
      python -m spacy download en_core_web_sm
    {% if trained_pipelines == "Finnish"%}
      python -m spacy download fi_core_news_sm
    {% if trained_pipelines == "French"%}
      python -m spacy download fr_core_news_sm
    {% if trained_pipelines == "German"%}
      python -m spacy download de_core_news_sm
    {% if trained_pipelines == "Greek"%}
      python -m spacy download el_core_news_sm
    {% if trained_pipelines == "Italian"%}
      python -m spacy download it_core_news_sm
    {% if trained_pipelines == "Japanese"%}
      python -m spacy download ja_core_news_sm
    {% if trained_pipelines == "Korean"%}
      python -m spacy download ko_core_news_sm
    {% if trained_pipelines == "Lithuanian"%}
      python -m spacy download lt_core_news_sm
    {% if trained_pipelines == "Macedonian"%}
      python -m spacy download mk_core_news_sm
    {% if trained_pipelines == "Multi-language"%}
      python -m spacy download xx_ent_wiki_sm
    {% if trained_pipelines == "Norwegian Bokmål"%}
      python -m spacy download nb_core_news_sm
    {% if trained_pipelines == "Polish"%}
      python -m spacy download pl_core_news_sm
    {% if trained_pipelines == "Portuguese"%}
      python -m spacy download pt_core_news_sm
    {% if trained_pipelines == "Romanian"%}
      python -m spacy download ro_core_news_sm
    {% if trained_pipelines == "Russian"%}
      python -m spacy download ru_core_news_sm
    {% if trained_pipelines == "Slovenian"%}
      python -m spacy download sl_core_news_sm
    {% if trained_pipelines == "Spanish"%}
      python -m spacy download es_core_news_sm
    {% if trained_pipelines == "Swedish"%}
      python -m spacy download sv_core_news_sm
    {% if trained_pipelines == "Ukrainian"%}
      python -m spacy download uk_core_news_sm     

  {% if package == "accuracy" %}
    {% if trained_pipelines == "Catalan"%}
      python -m spacy download ca_core_news_trf
    {% if trained_pipelines == "Chinese"%}
      python -m spacy download zh_core_web_trf
    {% if trained_pipelines == "Croatian"%}
      python -m spacy download hr_core_news_lg
    {% if trained_pipelines == "Danish"%}
      python -m spacy download da_core_news_trf
    {% if trained_pipelines == "Dutch"%}
      python -m spacy download nl_core_news_lg
    {% if trained_pipelines == "English"%}
      python -m spacy download en_core_web_trf
    {% if trained_pipelines == "Finnish"%}
      python -m spacy download fi_core_news_lg
    {% if trained_pipelines == "French"%}
      python -m spacy download fr_core_news_trf
    {% if trained_pipelines == "German"%}
      python -m spacy download de_core_news_trf
    {% if trained_pipelines == "Greek"%}
      python -m spacy download el_core_news_lg
    {% if trained_pipelines == "Italian"%}
      python -m spacy download it_core_news_lg
    {% if trained_pipelines == "Japanese"%}
      python -m spacy download ja_core_news_trf
    {% if trained_pipelines == "Korean"%}
      python -m spacy download ko_core_news_lg
    {% if trained_pipelines == "Lithuanian"%}
      python -m spacy download lt_core_news_lg
    {% if trained_pipelines == "Macedonian"%}
      python -m spacy download mk_core_news_lg
    {% if trained_pipelines == "Multi-language"%}
      python -m spacy download xx_ent_wiki_sm
    {% if trained_pipelines == "Norwegian Bokmål"%}
      python -m spacy download nb_core_news_lg
    {% if trained_pipelines == "Polish"%}
      python -m spacy download pl_core_news_lg
    {% if trained_pipelines == "Portuguese"%}
      python -m spacy download pt_core_news_lg
    {% if trained_pipelines == "Romanian"%}
      python -m spacy download ro_core_news_lg
    {% if trained_pipelines == "Russian"%}
      python -m spacy download ru_core_news_lg
    {% if trained_pipelines == "Slovenian"%}
      python -m spacy download sl_core_news_trf
    {% if trained_pipelines == "Spanish"%}
      python -m spacy download es_core_news_trf
    {% if trained_pipelines == "Swedish"%}
      python -m spacy download sv_core_news_lg
    {% if trained_pipelines == "Ukrainian"%}
      python -m spacy download uk_core_news_trf  
{%endmacro%}   
{% if package == "pip" %}
  pip install -U pip setuptools wheel &&
  pip install -U spacy

    {% if hardware == "cpu"  %}
      {% if os == "mac"%}
        {% if platform == "arm"%}
          -'[apple]"'
        {% endif %}
      {% endif %}
    {% endif %}

    {%if hardware == "gpu" %}
      {% if os == "linux"%}
        [cuda111]
      {% endif %}
      {%if os == "mac"%}
        [apple]
      {%endif%}
    {%endif%}
{%endif%}    

{% if package == "conda" %}     
  conda install -c conda-forge spacy
  {%if hardware == "gpu"%}
    conda install -c conda-forge cupy
  {%endif%}
{%endif%}

{%if package == "source"%}
  pip install -U pip setuptools wheel &&
  git clone https://github.com/explosion/spaCy &&
  cd spaCy &&
  pip install -r requirements.txt &&
  pip install --no-build-isolation --editable .

  {% if hardware == "gpu"%}
    {% if platform == "x86"%}
      '[cuda111]'
    {%endif%}
    {% if platform == "arm"%}
      {%if os == "windows"%}
        '[]'
      {%endif%}
      {% if os == "linux"%} 
        '[cuda111]'
      {%endif%}
      {% if os == "mac"%} 
        '[apple]'
      {%endif%}
    {%endif%}
  {%endif%}
{%endif%} #}